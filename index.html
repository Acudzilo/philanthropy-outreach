<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Philanthropy Outreach Calendar - Fail-Safe Version</title>
    <style>
        /* --- Clean, Modern Styling --- */
        :root { --blue: #3498db; --green: #2ecc71; --red: #e74c3c; --text: #2c3e50; --bg: #f4f7f9; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* --- Form Layout --- */
        form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; background: #eee; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input, select, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; }
        .full-width { grid-column: 1 / -1; }
        .btn-main { background: var(--blue); color: white; border: none; cursor: pointer; font-weight: bold; }
        .btn-main:hover { background: #2980b9; }

        /* --- Calendar Grid --- */
        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .month-box { background: white; border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
        .month-title { text-align: center; font-weight: bold; margin-bottom: 10px; background: #34495e; color: white; padding: 5px; border-radius: 3px; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .day-head { font-size: 0.7rem; text-align: center; font-weight: bold; color: #7f8c8d; }
        .day { aspect-ratio: 1/1; border: 1px solid #eee; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; cursor: pointer; }
        .day:hover { background: #f1f1f1; }
        .day-num { z-index: 2; }
        
        /* --- Multi-Event Bars --- */
        .bar-stack { width: 100%; position: absolute; bottom: 0; display: flex; flex-direction: column; gap: 1px; }
        .bar { height: 3px; width: 100%; }

        /* --- Table --- */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background: #34495e; color: white; }
        .overlap-warn { color: #e67e22; font-weight: bold; }

        /* --- Debug Footer --- */
        #debug-log { font-family: monospace; font-size: 0.7rem; color: #777; margin-top: 50px; border-top: 1px solid #ccc; padding-top: 10px; }
        
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="container">
    <h1>üóìÔ∏è Outreach & Comms Calendar</h1>

    <form id="outreachForm" class="no-print">
        <div class="full-width">
            <label><strong>Activity Name:</strong></label><br>
            <input type="text" id="itemName" style="width:98%" required placeholder="e.g. End of Year Appeal">
        </div>
        <div>
            <label>Color:</label><br>
            <select id="color" style="width:100%">
                <option value="#3498db">Blue</option>
                <option value="#2ecc71">Green</option>
                <option value="#f1c40f">Yellow</option>
                <option value="#e74c3c">Red</option>
                <option value="#9b59b6">Purple</option>
                <option value="#e67e22">Orange</option>
            </select>
        </div>
        <div>
            <label>Start Date:</label><br>
            <input type="date" id="startDate" style="width:100%" required>
        </div>
        <div>
            <label>End Date:</label><br>
            <input type="date" id="endDate" style="width:100%" required>
        </div>
        <button type="submit" class="btn-main" id="submitBtn" style="align-self: end;">Add to Calendar</button>
    </form>

    <div id="calendar-view" class="calendar-grid"></div>

    <h2>üìë Chronological List</h2>
    <table id="dataTable">
        <thead>
            <tr><th>Activity</th><th>Dates</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <div id="debug-log">System Status: Initializing...</div>
</div>

<script>
    // --- Data Management ---
    let outreachData = [];
    const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const log = document.getElementById('debug-log');

    // Load from LocalStorage
    try {
        const saved = localStorage.getItem('outreach_db');
        if (saved) outreachData = JSON.parse(saved);
        log.innerText = "System Status: Data Loaded. Total items: " + outreachData.length;
    } catch (e) {
        log.innerText = "System Status: Error loading local storage.";
    }

    // Form Submit
    document.getElementById('outreachForm').onsubmit = function(e) {
        e.preventDefault();
        const newItem = {
            id: Date.now(),
            name: document.getElementById('itemName').value,
            color: document.getElementById('color').value,
            start: document.getElementById('startDate').value,
            end: document.getElementById('endDate').value
        };

        outreachData.push(newItem);
        saveData();
        this.reset();
    };

    function saveData() {
        localStorage.setItem('outreach_db', JSON.stringify(outreachData));
        refreshUI();
    }

    function deleteItem(id) {
        outreachData = outreachData.filter(i => i.id !== id);
        saveData();
    }

    function refreshUI() {
        renderCalendar();
        renderTable();
    }

    // --- Calendar Logic ---
    function renderCalendar() {
        const view = document.getElementById('calendar-view');
        view.innerHTML = "";

        // Find range to display
        let startYear = new Date().getFullYear();
        let startMonth = 0; // Default Jan

        if (outreachData.length > 0) {
            const sorted = [...outreachData].sort((a,b) => a.start.localeCompare(b.start));
            const firstDate = new Date(sorted[0].start + "T00:00:00");
            startYear = firstDate.getFullYear();
            startMonth = firstDate.getMonth();
        }

        for (let i = 0; i < 12; i++) {
            let m = (startMonth + i) % 12;
            let y = startYear + Math.floor((startMonth + i) / 12);
            view.appendChild(createMonth(m, y));
        }
    }

    function createMonth(m, y) {
        const box = document.createElement('div');
        box.className = 'month-box';
        box.innerHTML = `<div class="month-title">${months[m]} ${y}</div>`;

        const grid = document.createElement('div');
        grid.className = 'days-grid';
        
        ['S','M','T','W','T','F','S'].forEach(d => grid.innerHTML += `<div class="day-head">${d}</div>`);

        const firstDay = new Date(y, m, 1).getDay();
        const daysInMonth = new Date(y, m + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div class="day empty"></div>`;

        for (let d = 1; d <= daysInMonth; d++) {
            const dateStr = `${y}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            const matches = outreachData.filter(item => dateStr >= item.start && dateStr <= item.end);

            const dayDiv = document.createElement('div');
            dayDiv.className = 'day';
            dayDiv.innerHTML = `<span class="day-num">${d}</span>`;

            if (matches.length > 0) {
                const stack = document.createElement('div');
                stack.className = 'bar-stack';
                matches.forEach(m => {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.backgroundColor = m.color;
                    stack.appendChild(bar);
                });
                dayDiv.appendChild(stack);
                dayDiv.title = matches.map(m => m.name).join(", ");
            }
            grid.appendChild(dayDiv);
        }
        box.appendChild(grid);
        return box;
    }

    // --- Table Logic ---
    function renderTable() {
        const tbody = document.querySelector('#dataTable tbody');
        tbody.innerHTML = "";
        
        const sorted = [...outreachData].sort((a,b) => a.start.localeCompare(b.start));

        sorted.forEach(item => {
            const isOverlap = sorted.some(other => 
                other.id !== item.id && item.start <= other.end && item.end >= other.start
            );

            const row = tbody.insertRow();
            row.innerHTML = `
                <td style="border-left: 5px solid ${item.color}"><strong>${item.name}</strong></td>
                <td>${item.start} to ${item.end}</td>
                <td>${isOverlap ? '<span class="overlap-warn">‚ö†Ô∏è Overlap</span>' : '‚úÖ Clear'}</td>
                <td><button onclick="deleteItem(${item.id})" style="background:#e74c3c; color:white; border:none; padding:5px; border-radius:3px; cursor:pointer;">Delete</button></td>
            `;
        });
    }

    // Initialize
    refreshUI();

</script>

</body>
</html>
